<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script src="/javascripts/jquery-1.6.2.js?1310253599" type="text/javascript"></script>
    <script src="/javascripts/jquery-ui-1.8.14.custom.min.js?1310705337" type="text/javascript"></script>
    <script src="/javascripts/jquery.json-2.2.min.js?1300883562" type="text/javascript"></script>
    <script src="/javascripts/jquery.mousewheel.3.0.2/jquery.mousewheel.min.js?1307620826" type="text/javascript"></script>
    <script src="/javascripts/jquery.zoom.js?1307882804" type="text/javascript"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            var canvas = $("#testCanvas")[0];
            var context = canvas.getContext('2d');
            var angle = -45 * Math.PI / 180;
            var cosa = Math.cos(angle);
            var sina = Math.sin(angle);
            var x = 200;
            var y = 0;
            var shiftx_x = - (x - (x * sina));
            var shiftx_y = - x * cosa;
            var shifty_x = - (x - (x * sina));
            var shifty_y = - x * cosa;
            var sx = 0.2;
            var sy = 0.2;
            var rectWidth = 20;
            var rectHeight = 20;
            context.fillRect(x, y, rectWidth, rectHeight);
            context.save();
            context.translate(x, y);
            context.rotate(angle);
            context.transform(1, sy, sx, 1, 0, 0);
//            console.log(shiftx_x);
//            console.log(shiftx_y);
//            context.fillStyle = "#f00";
//            context.fillRect(x, y, 20, 20);
//            context.translate( shiftx_x,  shiftx_y);
//            context.scale(1.5,  2 / 3);
            context.fillStyle = "#f00";
            context.fillRect(0, 0, rectWidth, rectHeight);
            context.restore();
//            context.scale(1.5,  2 / 3);

        });
    </script>
</head>
<body>
    <canvas id="testCanvas" width="400" height="400" style="border: 1px solid #000"/>

</body>
</html>